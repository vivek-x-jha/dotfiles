#!/usr/bin/env zsh

local repo="${1:-.}"
local exit_status=0

# Ensure git is available
command -v git &>/dev/null || {
  printf "${RED}[ERROR] git not found on PATH${RESET}\n" >&2
  return 1
}

# Ensure commitizen is available
command -v cz &>/dev/null || {
  printf "${RED}[ERROR] commitizen (cz) not found on PATH${RESET}\n" >&2
  return 1
}

# Ensure repo path exists
[[ -d $repo ]] || {
  printf "${RED}[ERROR] repo path not found: %s${RESET}\n" "$repo" >&2
  return 1
}

pushd "$repo" >/dev/null || return 1

{
  git add --all &&
    cz commit &&
    git push &&
    update-feature-branches
} || exit_status=$?

popd >/dev/null || return 1
return $exit_status
