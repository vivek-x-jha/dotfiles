#!/usr/bin/env zsh

local default=main
local branches=("$@")

# Dynamically fetch feature branches if no arguments are provided
[[ $# -eq 0 ]] && branches=("${(@f)$(git branch --format='%(refname:short)' | grep '^feature/')}")

if [[ ${#branches[@]} -eq 0 ]]; then
  printf "${YELLOW}[WARN] no feature branches updated${RESET}\n"
else
  for branch in "${branches[@]}"; do
    # Check if branch exists
    if ! git branch --format='%(refname:short)' | grep -Fxq "$branch"; then
      printf "${RED}[ERROR] '%s' not found${RESET} - run ${GREEN}'git branch'${RESET} to show available branches\n" "$branch"
      continue
    fi

    # Perform merge
    git switch "$branch" &>/dev/null
    git merge "$default" &>/dev/null

    # Print success message
    printf "${GREEN}âœ” ${RESET}${CYAN}%s${RESET} -> ${MAGENTA}${default}${RESET}\n" "$branch"
  done
fi

# Always return to main branch (once)
git switch "$default" &>/dev/null
